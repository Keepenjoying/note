# Linux內和分析（一）計算機是如何工作的


##一、計算機是如何工作的

首先我們要明確一個概念，就是計算機本身並不知道自己要做什麼，這些要做的事情需要我們去告知計算機，這就是程序代碼。早期的時候計算機每次只能做一件事情，他需要知道的是干什麼，怎麼幹。這就是程序代碼要體現的，程序的基礎目的在於有一個輸入（數據）然後經過處理（怎麼幹）得到我們想要的輸出。從計算機的邏輯層面來說就是處理器需要有輸入然後經過裡面的一些運算器件得到輸出。
現代計算機大都採用了一種叫做馮諾依曼的結構，叫什麼不重要，這種結構的意思就是我們現在所說的程序和數據都儲存在一起。所以計算機在運行的時候需要從中將數據取出，然後用程序進行處理，最後得到輸出。所以給計算機編寫程序代碼的時候也是要關心一下三件事：

```
1.程序要處理的輸入數據；
2.程序如何處理數據；
3.程序處理後的輸出；
```

所以在編寫程序時候需要做的就是告訴計算機需要處理哪些事情和如何處理以及要怎樣輸出結果。我們用以下面的代碼作為例子：

```c
int g(int x)
{
    return x + 8;
}

int f(int x)
{
    return g(x);
}

int main(void)
{
    return f(8) + 8;
}
```

我們看到，上述程序需要`處理的數據`是一些整數，`處理的過程`是調用f() 和g()連個函數進行運算，其中f(x)=g(x);g(x)=x+8;`處理的結果`就是返回f(8)+8這個值。但是高級語言是計算機不能直接看懂的，計算機智能看懂0101的機器語言，所以上述C語言代碼必須經過一個叫`編譯器`的東西翻譯成一種可以和0101機器語言直接映射的語言——`彙編語言`，這樣計算機就可以執行你寫的代碼了。

##二、X86彙編簡介（AT&T格式）

和我們使用的高級代碼一樣，彙編語言的指令也是需要知道`數據，處理，輸出`三個要素，只是這裡面我們把他們叫做`原操作數，指令碼，目的操作數`，具體的格式如下：

我們看到上述指令中要處理的數據是%esp，要輸出的數據是%ebp，要做的處理是movl這樣一種處理。意思就是將%esp寄存器中數傳送到%ebp寄存器中。上面這就是彙編語言指令的基本形式。
現在在linux系統中我們可以利用vi + [文件全程] 創建一個c代碼文件。比如在命令行中輸入vi exp01.c 進入新建文件，這時按字母i，表示開始編輯。將上述c代碼黏貼到文件中如下圖所示：

- exp01.c

```c
int g(int x)
{
    return x + 8;
}

int f(int x)
{
    return g(x);
}

int main(void)
{
    return f(8) + 8;
}
```

圖中我們看到代碼粘貼之後我們按esc按鍵退出編輯模式，再輸入「：wq」 表示保存退出。然後我們在輸入ls命令查看目錄下的文件發現已經有了我們之前插入的文件。這個時候輸入

```sh
gcc -S -o exp01.s exp01.c -m32
```

將要翻譯的exp01.c文件翻譯成上述的彙編代碼（翻譯的成32位彙編指令）用於再次翻譯成機器碼執行。


