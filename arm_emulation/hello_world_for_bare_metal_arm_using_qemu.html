<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Hello world for bare metal ARM using QEMU | Jason note</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../arm_emulation/emulating_arm_pl011_serial_ports.html" />
    
    
    <link rel="prev" href="../arm_emulation/simplest_bare_metal_program_for_arm.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    

        
    <div class="book" data-level="11.11" data-basepath=".." data-revision="Tue Jul 28 2015 22:52:42 GMT+0800 (CST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="shared_libraries/12.html">
            
                
                    <a href="../shared_libraries/12.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Command
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="shared_libraries/lsof.html">
            
                
                    <a href="../shared_libraries/lsof.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        10 條 Linux
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="shared_libraries/cntotw.html">
            
                
                    <a href="../shared_libraries/cntotw.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Open Chinese Convert 開放中文轉換
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="shared_libraries/index.html">
            
                
                    <a href="../shared_libraries/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Shared Libraries
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="shared_libraries/11.html">
            
                
                    <a href="../shared_libraries/11.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Shared Libraries Setup
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="linux_tools/index.html">
            
                
                    <a href="../linux_tools/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Linux Tools
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="linux_tools/linux_basic.html">
            
                
                    <a href="../linux_tools/linux_basic.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Linux Basic
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="linux_tools/01_use_man.html">
            
                
                    <a href="../linux_tools/01_use_man.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        學會使用命令幫助
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="linux_tools/02_file_manage.html">
            
                
                    <a href="../linux_tools/02_file_manage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        文件及目錄管理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="linux_tools/03_text_processing.html">
            
                
                    <a href="../linux_tools/03_text_processing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.</b>
                        
                        文本處理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="linux_tools/04_disk.html">
            
                
                    <a href="../linux_tools/04_disk.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.4.</b>
                        
                        磁盤管理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="linux_tools/05_process_manage.html">
            
                
                    <a href="../linux_tools/05_process_manage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.5.</b>
                        
                        進程管理工具
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="linux_tools/06_monitor.html">
            
                
                    <a href="../linux_tools/06_monitor.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.6.</b>
                        
                        性能監控
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="linux_tools/07_network.html">
            
                
                    <a href="../linux_tools/07_network.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.7.</b>
                        
                        網絡工具
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="linux_tools/08_user_manage.html">
            
                
                    <a href="../linux_tools/08_user_manage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.8.</b>
                        
                        用戶管理工具
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="linux_tools/09_system_manage.html">
            
                
                    <a href="../linux_tools/09_system_manage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.9.</b>
                        
                        系統管理及IPC資源管理
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="linux_tools/linux_advance.html">
            
                
                    <a href="../linux_tools/linux_advance.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Linux工具進階
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="linux_tools/01_program_buil.html">
            
                
                    <a href="../linux_tools/01_program_buil.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.1.</b>
                        
                        程序構建
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="linux_tools/02_program_debug.html">
            
                
                    <a href="../linux_tools/02_program_debug.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.2.</b>
                        
                        程序調試
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="linux_tools/03_optimization.html">
            
                
                    <a href="../linux_tools/03_optimization.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.3.</b>
                        
                        性能優化
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="linux_tools/ref_tool.html">
            
                
                    <a href="../linux_tools/ref_tool.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        工具參考篇
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="linux_tools/gdb.html">
            
                
                    <a href="../linux_tools/gdb.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.1.</b>
                        
                        gdb 調試利器
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="linux_tools/ldd.html">
            
                
                    <a href="../linux_tools/ldd.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.2.</b>
                        
                        ldd 查看程序依賴庫
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="linux_tools/ldof.html">
            
                
                    <a href="../linux_tools/ldof.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.</b>
                        
                        lsof 一切皆文件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="linux_tools/ps.html">
            
                
                    <a href="../linux_tools/ps.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.4.</b>
                        
                        ps 進程查看器
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.5" data-path="linux_tools/pstack.html">
            
                
                    <a href="../linux_tools/pstack.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.5.</b>
                        
                        pstack 跟蹤進程棧
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.6" data-path="linux_tools/strace.html">
            
                
                    <a href="../linux_tools/strace.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.6.</b>
                        
                        strace 跟蹤進程中的系統調用
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.7" data-path="linux_tools/ipcs.html">
            
                
                    <a href="../linux_tools/ipcs.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.7.</b>
                        
                        ipcs 查詢進程間通信狀態
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.8" data-path="linux_tools/top.html">
            
                
                    <a href="../linux_tools/top.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.8.</b>
                        
                        top linux下的任務管理器
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.9" data-path="linux_tools/free.html">
            
                
                    <a href="../linux_tools/free.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.9.</b>
                        
                        free 查詢可用內存
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.10" data-path="linux_tools/vmstat.html">
            
                
                    <a href="../linux_tools/vmstat.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.10.</b>
                        
                        vmstat 監視內存使用情況
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.11" data-path="linux_tools/iostat.html">
            
                
                    <a href="../linux_tools/iostat.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.11.</b>
                        
                        iostat 監視I/O子系統
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.12" data-path="linux_tools/sar.html">
            
                
                    <a href="../linux_tools/sar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.12.</b>
                        
                        sar 找出系統瓶頸的利器
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.13" data-path="linux_tools/readelf.html">
            
                
                    <a href="../linux_tools/readelf.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.13.</b>
                        
                        readelf elf文件格式分析
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.14" data-path="linux_tools/objdump.html">
            
                
                    <a href="../linux_tools/objdump.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.14.</b>
                        
                        objdump 二進制文件分析
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.15" data-path="linux_tools/nm.html">
            
                
                    <a href="../linux_tools/nm.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.15.</b>
                        
                        nm 目標文件格式分析
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.16" data-path="linux_tools/size.html">
            
                
                    <a href="../linux_tools/size.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.16.</b>
                        
                        size 查看程序內存映像大小
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.17" data-path="linux_tools/wget.html">
            
                
                    <a href="../linux_tools/wget.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.17.</b>
                        
                        wget 文件下載
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.18" data-path="linux_tools/scp.html">
            
                
                    <a href="../linux_tools/scp.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.18.</b>
                        
                        scp 跨機遠程拷貝
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.19" data-path="linux_tools/crontab.html">
            
                
                    <a href="../linux_tools/crontab.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.19.</b>
                        
                        crontab 定時任務
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3.20" data-path="linux_tools/trace-cmd.html">
            
                
                    <a href="../linux_tools/trace-cmd.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.20.</b>
                        
                        trace-cmd
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="linux_tools/doxygen.html">
            
                
                    <a href="../linux_tools/doxygen.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Doxygen
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="linux_tools/jdbshell.html">
            
                
                    <a href="../linux_tools/jdbshell.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Jdbshell
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="bggdb/index.html">
            
                
                    <a href="../bggdb/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Beej&#39;s Quick Guide to GDB
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="android_note/index.html">
            
                
                    <a href="../android_note/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Android note
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="android_note/514.html">
            
                
                    <a href="../android_note/514.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        android resource
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="android_note/startservice_bindservice.html">
            
                
                    <a href="../android_note/startservice_bindservice.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        什麼時候用startService，什麼時候用bindService
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="android_note/handler_looper_message_runnable.html">
            
                
                    <a href="../android_note/handler_looper_message_runnable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        android的消息處理機制（圖+源碼分析）——Looper,Handler,Message
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="android_note/runnable_thread.html">
            
                
                    <a href="../android_note/runnable_thread.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Android中Handler Runnable與Thread的區別詳解
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="android_note/android_service_native_service.html">
            
                
                    <a href="../android_note/android_service_native_service.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Android Service與Native Service
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="android_note/handler_message_looper_messagequeue.html">
            
                
                    <a href="../android_note/handler_message_looper_messagequeue.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Handler, Message, Looper, MessageQueue
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="android_note/android_log.html">
            
                
                    <a href="../android_note/android_log.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        Android 各層中日誌打印功能的應用
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="android_note/android_command.html">
            
                
                    <a href="../android_note/android_command.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        Android指令和命令參數
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="android_note/prcess_thread_ipc.html">
            
                
                    <a href="../android_note/prcess_thread_ipc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        Android中進程與進程、線程與線程之間如何通信
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="android_note/startservice.html">
            
                
                    <a href="../android_note/startservice.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        startService的創建過程
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="android_note/bindservice.html">
            
                
                    <a href="../android_note/bindservice.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        service組件-bindService源碼分析
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.12" data-path="android_note/511.html">
            
                
                    <a href="../android_note/511.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.12.</b>
                        
                        [轉]Android 執行緒 - Thread 與 Handler
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.13" data-path="android_note/512.html">
            
                
                    <a href="../android_note/512.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.13.</b>
                        
                        [轉] Android 執行緒 - Runnable 與 Handler
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.14" data-path="android_note/513.html">
            
                
                    <a href="../android_note/513.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.14.</b>
                        
                        [轉] Android 非同步任務 - AsyncTask
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.15" data-path="android_note/515.html">
            
                
                    <a href="../android_note/515.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.15.</b>
                        
                        [轉]Android.mk 組織結構
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.16" data-path="android_note/android_goldfishkernel.html">
            
                
                    <a href="../android_note/android_goldfishkernel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.16.</b>
                        
                        如何下載編譯Android goldfish(Kernel)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.17" data-path="android_note/android.html">
            
                
                    <a href="../android_note/android.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.17.</b>
                        
                        自己動手編譯android源碼
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="ubuntu/index.html">
            
                
                    <a href="../ubuntu/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Ubuntu
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="ubuntu/ubuntu_installer.html">
            
                
                    <a href="../ubuntu/ubuntu_installer.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Ubuntu installer
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="qemu/index.html">
            
                
                    <a href="../qemu/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        QEMU
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="qemu/qemu_kgdb_ftrace.html">
            
                
                    <a href="../qemu/qemu_kgdb_ftrace.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Qemu_KGDB_Ftrace
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="linux_device_driver_programming/index.html">
            
                
                    <a href="../linux_device_driver_programming/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Linux Device Driver Programming
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="linux_device_driver_programming/01.html">
            
                
                    <a href="../linux_device_driver_programming/01.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Linux 裝置驅動程式的概要
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="linux_device_driver_programming/02.html">
            
                
                    <a href="../linux_device_driver_programming/02.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Linux 的授權
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="linux_device_driver_programming/03.html">
            
                
                    <a href="../linux_device_driver_programming/03.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        準備開發裝置驅動程式
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="linux_device_driver_programming/04.html">
            
                
                    <a href="../linux_device_driver_programming/04.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        開發驅動程式的第一步
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="linux_device_driver_programming/05.html">
            
                
                    <a href="../linux_device_driver_programming/05.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        開發 driver 需要的基礎知識
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="fcamel/index.html">
            
                
                    <a href="../fcamel/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        fcamel
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="fcamel/01.html">
            
                
                    <a href="../fcamel/01.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        [轉]ld, ld.so 和 ldconfig 的行為
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="fcamel/02.html">
            
                
                    <a href="../fcamel/02.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        [轉]解決 undefined symbol / reference
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="fcamel/03.html">
            
                
                    <a href="../fcamel/03.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        [轉] 列出用到的 shared library
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="fcamel/04.html">
            
                
                    <a href="../fcamel/04.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        [轉]用 LD_PRELOAD 替換動態連結的函式庫
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.5" data-path="fcamel/05.html">
            
                
                    <a href="../fcamel/05.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.5.</b>
                        
                        [轉] 用 strace 和 ltrace 找出用到的 system call 和 library call
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.6" data-path="fcamel/[]__linking_time.html">
            
                
                    <a href="../fcamel/[]__linking_time.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.6.</b>
                        
                        [轉] 加速 linking time
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.7" data-path="fcamel/07.html">
            
                
                    <a href="../fcamel/07.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.7.</b>
                        
                        [轉] 從 C 呼叫 C++ 函式的過程理解程式編譯、連結的原理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.8" data-path="fcamel/08.html">
            
                
                    <a href="../fcamel/08.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.8.</b>
                        
                        [轉] 對 C++ 的觀感
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.9" data-path="fcamel/09.html">
            
                
                    <a href="../fcamel/09.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.9.</b>
                        
                        [轉]在 Linux 下開發 C/C++ 的新手指南
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10" data-path="fcamel/10.html">
            
                
                    <a href="../fcamel/10.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.</b>
                        
                        [轉]瞭解 C/C++ 程式行為的技巧
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.10.1" data-path="fcamel/91001.html">
            
                
                    <a href="../fcamel/91001.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.1.</b>
                        
                        查 C/C++ symbol 定義的方法
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.2" data-path="fcamel/91002.html">
            
                
                    <a href="../fcamel/91002.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.2.</b>
                        
                        閱讀 C/C++ 原始碼的好幫手
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.3" data-path="fcamel/91003.html">
            
                
                    <a href="../fcamel/91003.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.3.</b>
                        
                        配合 c++filt 讀程式
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.4" data-path="fcamel/91004.html">
            
                
                    <a href="../fcamel/91004.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.4.</b>
                        
                        加速 gdb 載入 symbol 時間
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.5" data-path="fcamel/91005.html">
            
                
                    <a href="../fcamel/91005.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.5.</b>
                        
                        在 x86-64 上對 system call 使用 conditional break
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.6" data-path="fcamel/91006.html">
            
                
                    <a href="../fcamel/91006.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.6.</b>
                        
                        用 strace 找出 Ubuntu 如何提示未安裝的指令
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.7" data-path="fcamel/91007.html">
            
                
                    <a href="../fcamel/91007.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.7.</b>
                        
                        自行編譯含 debug symbol 的套件 (package)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.8" data-path="fcamel/91008.html">
            
                
                    <a href="../fcamel/91008.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.8.</b>
                        
                        gdb 顯示 STL container 的方法
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.9" data-path="fcamel/91009.html">
            
                
                    <a href="../fcamel/91009.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.9.</b>
                        
                        善用 strace、debugger 從執行期間找出問題根源
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9.10.10" data-path="fcamel/91010.html">
            
                
                    <a href="../fcamel/91010.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.10.10.</b>
                        
                        用 python gdb 客製化 backtrace 的結果
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="arm/index.html">
            
                
                    <a href="../arm/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        ARM
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="arm/101.html">
            
                
                    <a href="../arm/101.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        ARM彙編語言
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="arm/102.html">
            
                
                    <a href="../arm/102.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.2.</b>
                        
                        ARM尋址方式
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="arm_emulation/index.html">
            
                
                    <a href="../arm_emulation/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        ARM emulation
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="11.1" data-path="arm_emulation/compiling_linux_kernel_for_qemu_arm_emulator.html">
            
                
                    <a href="../arm_emulation/compiling_linux_kernel_for_qemu_arm_emulator.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.</b>
                        
                        Compiling Linux kernel for QEMU ARM emulator
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="arm_emulation/compiling_linux_kernel_30_with_emdebian_arm_toolchain.html">
            
                
                    <a href="../arm_emulation/compiling_linux_kernel_30_with_emdebian_arm_toolchain.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.2.</b>
                        
                        Compiling Linux kernel 3.0 with Emdebian ARM toolchain
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="arm_emulation/compile_linux_kernel_32_for_arm_and_emulate_with_qemu.html">
            
                
                    <a href="../arm_emulation/compile_linux_kernel_32_for_arm_and_emulate_with_qemu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.3.</b>
                        
                        Compile Linux kernel 3.2 for ARM and emulate with QEMU
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="arm_emulation/busybox_for_arm_on_qemu.html">
            
                
                    <a href="../arm_emulation/busybox_for_arm_on_qemu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.4.</b>
                        
                        Busybox for ARM on QEMU
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="arm_emulation/linux_nfs_root_under_qemu_arm_emulator.html">
            
                
                    <a href="../arm_emulation/linux_nfs_root_under_qemu_arm_emulator.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.5.</b>
                        
                        Linux NFS Root under QEMU ARM emulator
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.6" data-path="arm_emulation/trying_debian_for_arm_on_qemu.html">
            
                
                    <a href="../arm_emulation/trying_debian_for_arm_on_qemu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.6.</b>
                        
                        Trying Debian for ARM on QEMU
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.7" data-path="arm_emulation/debugging_arm_programs_inside_qemu.html">
            
                
                    <a href="../arm_emulation/debugging_arm_programs_inside_qemu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.7.</b>
                        
                        Debugging ARM programs inside QEMU
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.8" data-path="arm_emulation/u-boot_for_arm_on_qemu.html">
            
                
                    <a href="../arm_emulation/u-boot_for_arm_on_qemu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.8.</b>
                        
                        U-boot for ARM on QEMU
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.9" data-path="arm_emulation/booting_linux_with_u-boot_on_qemu_arm.html">
            
                
                    <a href="../arm_emulation/booting_linux_with_u-boot_on_qemu_arm.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.9.</b>
                        
                        Booting Linux with U-Boot on QEMU ARM
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.10" data-path="arm_emulation/simplest_bare_metal_program_for_arm.html">
            
                
                    <a href="../arm_emulation/simplest_bare_metal_program_for_arm.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.10.</b>
                        
                        Simplest bare metal program for ARM
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="11.11" data-path="arm_emulation/hello_world_for_bare_metal_arm_using_qemu.html">
            
                
                    <a href="../arm_emulation/hello_world_for_bare_metal_arm_using_qemu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.11.</b>
                        
                        Hello world for bare metal ARM using QEMU
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.12" data-path="arm_emulation/emulating_arm_pl011_serial_ports.html">
            
                
                    <a href="../arm_emulation/emulating_arm_pl011_serial_ports.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.12.</b>
                        
                        Emulating ARM PL011 serial ports
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.13" data-path="arm_emulation/arm926_interrupts_in_qemu.html">
            
                
                    <a href="../arm_emulation/arm926_interrupts_in_qemu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.13.</b>
                        
                        ARM926 interrupts in QEMU
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.14" data-path="arm_emulation/using_ubuntu_arm_cross-compiler_for_bare_metal_programming.html">
            
                
                    <a href="../arm_emulation/using_ubuntu_arm_cross-compiler_for_bare_metal_programming.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.14.</b>
                        
                        Using Ubuntu ARM cross-compiler for bare metal programming
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.15" data-path="arm_emulation/using_newlib_in_arm_bare_metal_programs.html">
            
                
                    <a href="../arm_emulation/using_newlib_in_arm_bare_metal_programs.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.15.</b>
                        
                        Using Newlib in ARM bare metal programs
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.16" data-path="arm_emulation/using_codesourcery_bare_metal_toolchain_for_cortex-m3.html">
            
                
                    <a href="../arm_emulation/using_codesourcery_bare_metal_toolchain_for_cortex-m3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.16.</b>
                        
                        Using CodeSourcery bare metal toolchain for Cortex-M3
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.17" data-path="arm_emulation/qemu_arm_semihosting.html">
            
                
                    <a href="../arm_emulation/qemu_arm_semihosting.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.17.</b>
                        
                        QEMU ARM semihosting
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11.18" data-path="arm_emulation/simulating_at91_with_skyeye.html">
            
                
                    <a href="../arm_emulation/simulating_at91_with_skyeye.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.18.</b>
                        
                        Simulating AT91 with Skyeye
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="12" data-path="linux_kernel/index.html">
            
                
                    <a href="../linux_kernel/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Linux Kernel
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="12.1" data-path="linux_kernel/121.html">
            
                
                    <a href="../linux_kernel/121.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.1.</b>
                        
                        我理解的邏輯地址、線性地址、物理地址和虛擬地址
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12.2" data-path="linux_kernel/122.html">
            
                
                    <a href="../linux_kernel/122.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.2.</b>
                        
                        用ttyS0獲取dmesg信息
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12.3" data-path="linux_kernel/123.html">
            
                
                    <a href="../linux_kernel/123.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.3.</b>
                        
                        Buddy Algorithm
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12.4" data-path="linux_kernel/124.html">
            
                
                    <a href="../linux_kernel/124.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.4.</b>
                        
                        分析oops的機器碼
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12.5" data-path="linux_kernel/125.html">
            
                
                    <a href="../linux_kernel/125.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.5.</b>
                        
                        oops調試
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12.6" data-path="linux_kernel/126.html">
            
                
                    <a href="../linux_kernel/126.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.6.</b>
                        
                        可搶佔
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12.7" data-path="linux_kernel/127.html">
            
                
                    <a href="../linux_kernel/127.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.7.</b>
                        
                        異或的用法
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12.8" data-path="linux_kernel/128.html">
            
                
                    <a href="../linux_kernel/128.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.8.</b>
                        
                        定製編譯內核模塊的GCC參數
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Jason note</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="hello-world-for-bare-metal-arm-using-qemu">Hello world for bare metal ARM using QEMU</h1>
<p>Last time I wrote about writing and debugging bare metal ARM software using the CodeSourcery toolchain. Now I want to exploit QEMU&#x2019;s emulation of a complete system and create the simplest &#x201C;Hello world!&#x201D; example.</p>
<p>The QEMU emulator supports the VersatilePB platform, that contains an ARM926EJ-S core and, among other peripherals, four UART serial ports; the first serial port in particular (UART0) works  as a terminal when using the <strong>-nographic or &#x201C;-serial stdio&#x201D; </strong>qemu option. The memory map of the VersatilePB board is implemented in QEMU in this board-specific C source; from that I note the address where the UART0 is mapped: <strong>0x101f1000</strong>. The code that emulates the serial port inside QEMU (here in the source repository) implements a subset of the functionalities of the PL011 Prime Cell UART from ARM; there is a useful technical manual from the ARM info center that describes how to interact with the hardware. In details, there is a register (UARTDR) that is used to transmit (when writing in the register) and receive (when reading) bytes; this register is placed at offset <strong>0x0</strong>, so I need to read and write at the beginning of the memory allocated for the UART0.</p>
<p>To implement the simple &#x201C;Hello world!&#x201D; printing, I wrote this test.c file:</p>
<pre><code class="lang-c"><span class="hljs-keyword">volatile</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> * <span class="hljs-keyword">const</span> UART0DR = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)<span class="hljs-number">0x101f1000</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_uart0</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *s)</span> </span>{
    <span class="hljs-keyword">while</span>(*s != <span class="hljs-string">&apos;\0&apos;</span>) { <span class="hljs-comment">/* Loop until end of string */</span>
        *UART0DR = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(*s); <span class="hljs-comment">/* Transmit char */</span>
        s++; <span class="hljs-comment">/* Next char */</span>
    }
}


<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">c_entry</span><span class="hljs-params">()</span> </span>{
    print_uart0(<span class="hljs-string">&quot;Hello world!\n&quot;</span>);
}
</code></pre>
<p>The code is pretty straightforward; a couple of details:</p>
<ul>
<li>The volatile keyword is necessary to instruct the compiler that the memory pointed by UART0DR can change or has effects independently of the program.</li>
<li>The unsigned int type enforces 32-bits read and write access.</li>
<li>The QEMU model of the PL011 serial port ignores the transmit FIFO capabilities; in a real system on chip the &#x201C;Transmit FIFO Full&#x201D; flag must be checked in the UARTFR register before writing on the UARTDR register.</li>
</ul>
<p>The QEMU emulator is written especially to emulate Linux guest systems; for this reason its startup procedure is implemented specifically: the -kernel option loads a binary file (usually a Linux kernel) inside the system memory starting at address <strong>0x00010000</strong>. The emulator starts the execution at address <strong>0x00000000</strong>, where few instructions (already in place) are used to jump at the beginning of the kernel image. The interrupt table of ARM cores, usually placed at address <strong>0x00000000</strong>, is not present, and the peripheral interrupts are disabled at startup, as needed to boot a Linux kernel. Knowing this, to implement a working emulation I need to considerate a few things:</p>
<ul>
<li>The software must be compiled and linked to be placed at <strong>0x00010000</strong></li>
<li>I need to create a binary image of our program</li>
<li>I can ignore interrupt handling for now</li>
</ul>
<p>This is the startup.s assembler file I wrote, simplified from the one I wrote in the previous blog post:</p>
<pre><code>.global _Reset
_Reset:
 LDR sp, =stack_top
 BL c_entry
 B .
</code></pre><p>And this is the linker script test.ld, modified from last time to place the program at the right address (thanks to Gnurou for the suggestion to specify only the text section of startup.o):</p>
<pre><code>ENTRY(_Reset)
SECTIONS
{
 . = 0x10000;
 .startup . : { startup.o(.text) }
 .text : { *(.text) }
 .data : { *(.data) }
 .bss : { *(.bss COMMON) }
 . = ALIGN(8);
 . = . + 0x1000; /* 4kB of stack memory */
 stack_top = .;
}
</code></pre><p>To create the binary file, the CodeSourcery toolchain (arm-none-eabi type) must be installed and the PATH environmental variable must be set accordingly. These are the commands to run:</p>
<pre><code class="lang-sh">$ arm-none-eabi-as -mcpu=arm926ej<span class="hljs-operator">-s</span> -g startup.s -o startup.o
$ arm-none-eabi-gcc -c -mcpu=arm926ej<span class="hljs-operator">-s</span> -g test.c -o test.o
$ arm-none-eabi-ld -T test.ld test.o startup.o -o test.elf
$ arm-none-eabi-objcopy -O binary test.elf test.bin
</code></pre>
<p>These commands create a test.elf program and a test.bin binary image that I can use with the QEMU emulator for ARM systems. In Debian, QEMU can be installed running &#x201C;apt-get install qemu&#x201D; as root, and the installation includes the qemu-system-arm program that I need in my example. In Ubuntu machines, this program is not present in the qemu package but is placed instead in the qemu-kvm-extras package; for this reason the &#x201C;sudo apt-get install qemu-kvm-extras&#x201D; command must be used to install it.</p>
<p>To run my program in the emulator, the command is:</p>
<pre><code>$ qemu-system-arm -M versatilepb -m 128M -nographic -kernel test.bin
</code></pre><p>The -M option specifies the emulated system. The program prints &#x201C;Hello world!&#x201D; in the
terminal and runs indefinitely; to exit QEMU, press &#x201C;Ctrl + a&#x201D; and then &#x201C;x&#x201D;.</p>
<p>It is possible also to debug the program using the CodeSourcery version of gdb, because QEMU implements a gdb connector using a TCP connection. To do so, I run the emulator with the correct options as follows:</p>
<pre><code>$ qemu-system-arm -M versatilepb -m 128M -nographic -s -S -kernel test.bin
</code></pre><p>This command freezes the system before executing any guest code, and waits for a connection on the TCP port 1234. From another terminal, I run arm-none-eabi-gdb and enter the commands:</p>
<pre><code>target remote localhost:1234
file test.elf
</code></pre><p>This connects to the QEMU system and loads the debugging symbols of the test program, whose binary image is already loaded in the system memory. From there, it is possible to run the program with the continue command, single-step the program and debug it in general. The exit command in gdb closes both the debugger and the emulator.</p>
<p>To summarize the necessary steps to create a &#x201C;Hello world&#x201D; program:</p>
<ul>
<li>Install CodeSourcery toolchain</li>
<li>Install QEMU (in particular qemu-system-arm)</li>
<li>Write the test.c, startup.s and test.ld source files</li>
<li>Build the test ELF and binary image</li>
<li>Run QEMU ARM emulator using the created binary image as a kernel</li>
<li>Run the gdb debugger and attach to QEMU</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../arm_emulation/simplest_bare_metal_program_for_arm.html" class="navigation navigation-prev " aria-label="Previous page: Simplest bare metal program for ARM"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../arm_emulation/emulating_arm_pl011_serial_ports.html" class="navigation navigation-next " aria-label="Next page: Emulating ARM PL011 serial ports"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
